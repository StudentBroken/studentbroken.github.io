<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyseur Dynamique V10 (Pathfinder V2)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
:root {
    --primary-color: #5B21B6; /* Violet */
    --secondary-color: #059669; /* Green */
    --warning-color: #F59E0B; /* Orange */
    --danger-color: #DC2626; /* Red */
    --bg-color: #f9fafb; /* Light Gray */
    --widget-background: #ffffff; /* White for widgets */
    --text-color: #1f2937; /* Dark Gray for main text */
    --text-secondary-color: #6b7280; /* Medium Gray for secondary text */
    --accent-color: #3B82F6; /* Blue accent */
    --light-grey: #e0e6eb; /* Light border/background */
    --footer-grey: #6b7280; /* Footer text color */
    --shadow-header: 0 2px 4px rgba(0,0,0,0.05);
    --shadow-widget: 0 8px 15px rgba(0,0,0,0.08);
    --border-color: #e0e6eb;
    --goal-success-bg: #eafaf1;
    --goal-warning-bg: #fff9f0;
    --goal-danger-bg: #fdf3f2;
    --transition-duration: 0.3s;
}

/* General Styles & Transitions */
body, .side-panel, .tab-content, .modal-content, .tab-btn, select, input, .score-card, .prediction-card, .ai-insight-box, .subject-table, .help-btn, .back-to-main-btn, .gauge-needle, .bg-violet-100, .site-header-container, .subject-widget, .widget-top-section, .widget-info, .widget-title, .widget-average, .widget-trend, .gauge-container, .histogram-container, .widget-chart-controls, #expanded-view-overlay, #expanded-view-grid, .details-widget-body, .competency-widgets, .comp-widget, .calculator-container, .goal-input, .goal-result, .btn-save, .mini-leaderboard-container, .leaderboard-list, .leaderboard-item, .item-rank, .item-name, .item-grade, .widget-rank {
    transition: background-color var(--transition-duration) ease, color var(--transition-duration) ease, border-color var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
}
body {
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    margin: 0;
}

/* Header Styles */
.site-header-container {
    background-color: var(--widget-background);
    box-shadow: var(--shadow-header);
    border-bottom: 1px solid var(--border-color);
    padding: 15px 25px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.header-left, .header-right {
    display: flex;
    align-items: center;
    gap: 15px;
    flex: 1;
}
.header-right {
    justify-content: flex-end;
}
.site-header {
    flex: 2;
    text-align: center;
    padding: 0;
    margin: 0;
    color: var(--secondary-color);
    font-size: 2.2em;
    font-family: 'Playfair Display', serif;
}
.icon-btn {
    background: none;
    border: 2px solid var(--light-grey);
    color: var(--text-color);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1em;
    text-decoration: none;
    transition: all 0.2s ease;
}
.icon-btn:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
    transform: scale(1.1);
}
.btn-secondary {
    text-decoration: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    background-color: var(--primary-color);
    color: white;
    border: none;
    transition: all 0.2s ease;
}
.btn-secondary:hover {
    background-color: color-mix(in srgb, var(--primary-color) 80%, white); /* Darken on hover */
}

/* Tabs & Grid */
.sticky-tabs {
    position: sticky;
    top: 0;
    background-color: var(--bg-color);
    z-index: 100;
    padding: 15px 0;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
}
.tab-btn {
    padding: 10px 20px;
    border: 1px solid var(--light-grey);
    border-radius: 20px;
    background-color: transparent;
    color: var(--text-color);
    font-weight: 600;
    cursor: pointer;
}
.tab-btn.active {
    background-color: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}
.widget-grid {
    max-width: 1400px;
    margin: 30px auto;
    padding: 0 20px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
    gap: 25px;
}

/* Subject Widget Styles */
.subject-widget {
    background-color: var(--widget-background);
    border-radius: 12px;
    box-shadow: var(--shadow-widget);
    padding: 20px;
    display: flex;
    flex-direction: column;
    transition: transform 0.2s, box-shadow 0.2s;
}
.subject-widget:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 20px rgba(0,0,0,0.1);
}
.widget-top-section {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 15px;
    cursor: pointer;
}
.widget-info { flex: 1; }
.widget-title {
    font-size: 1.2em;
    font-weight: 700;
    color: var(--secondary-color);
    margin: 0 0 10px 0;
}
.widget-average {
    font-size: 2.5em;
    font-weight: 700;
    color: var(--primary-color);
    margin: 0;
}
.widget-trend {
    display: flex;
    align-items: center;
    gap: 5px;
    font-weight: 600;
    font-size: 0.9em;
    margin-top: 5px;
}
.widget-trend.up { color: var(--success-color); }
.widget-trend.down { color: var(--danger-color); }
.widget-trend.neutral { color: var(--text-secondary-color); }
.gauge-container { width: 120px; height: 70px; position: relative; }
.histogram-container { margin-top: 15px; height: 120px; }
.widget-chart-controls {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    margin-bottom: 5px;
    height: 25px;
    gap: 5px;
}
.chart-toggle-btn {
    background: none;
    border: 1px solid var(--border-color);
    color: var(--light-grey);
    padding: 4px 8px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.8em;
}
.chart-toggle-btn:hover {
    color: var(--primary-color);
    border-color: var(--primary-color);
}

/* EXPANDED VIEW (replaces modal) */
#expanded-view-overlay {
    position: fixed;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
    z-index: 1000;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
    padding: 20px;
    box-sizing: border-box;
}
#expanded-view-overlay.active {
    opacity: 1;
    visibility: visible;
}
#expanded-view-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 25px;
    width: 100%;
    max-width: 1400px;
    max-height: 95vh;
}
#expanded-view-grid .subject-widget {
    transform: scale(0.9);
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
#expanded-view-overlay.active .subject-widget {
    transform: scale(1);
}
#expanded-view-grid .subject-widget { cursor: default; }
#expanded-view-grid .widget-top-section { cursor: default; }
#expanded-view-grid .subject-widget:hover { transform: translateY(0); box-shadow: var(--shadow-widget); }

/* Center Widget (Details) */
.details-widget-body {
    height: calc(95vh - 120px);
    overflow-y: auto;
    padding-right: 10px;
}
.competency-widgets {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}
.comp-widget {
    flex: 1;
    min-width: 150px;
    background-color: var(--widget-background);
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    border: 1px solid var(--border-color);
    cursor: pointer;
    transition: all 0.2s;
}
.comp-widget.active {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px var(--primary-color);
}
.calculator-container {
    background-color: var(--widget-background);
    border-radius: 8px;
    padding: 20px;
    border: 1px solid var(--border-color);
    margin-top: 25px;
}
.goal-input {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}
.goal-input input {
    width: 80px;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid var(--light-grey);
    text-align: center;
    font-size: 1.1em;
}
.goal-result {
    padding: 15px;
    border-radius: 6px;
    text-align: center;
    font-size: 1.1em;
    font-weight: 600;
}
.goal-result.success { background-color: var(--goal-success-bg); color: var(--success-color); }
.goal-result.warning { background-color: var(--goal-warning-bg); color: var(--warning-color); }
.goal-result.danger { background-color: var(--goal-danger-bg); color: var(--danger-color); }
.btn-save {
    padding: 8px 12px;
    border: none;
    background-color: var(--primary-color);
    color: white;
    border-radius: 6px;
    cursor: pointer;
}

/* Right Widget (Ranking) */
.mini-leaderboard-container {
    flex-grow: 1;
    overflow-y: auto;
    position: relative;
    border-top: 1px solid var(--light-grey);
    padding-top: 15px;
    max-height: 250px;
}
.leaderboard-list { list-style: none; padding: 0; margin: 0; }
.leaderboard-item {
    display: flex;
    align-items: center;
    padding: 8px 10px;
    border-radius: 8px;
    font-size: 0.9em;
    transition: background-color 0.2s;
}
.leaderboard-item.is-user { background-color: #eaf2f8; font-weight: bold; }
.item-rank { width: 40px; } .item-name { flex-grow: 1; } .item-grade { font-weight: 600; }
.widget-rank { font-size: 1.1em; color: var(--secondary-color); margin-top: 5px; }

/* Ghost Loading Animation */
@keyframes ghost-loading {
    0% { background-color: rgba(128, 128, 128, 0.1); }
    50% { background-color: rgba(128, 128, 128, 0.2); }
    100% { background-color: rgba(128, 128, 128, 0.1); }
}
.ghost-item {
    animation: ghost-loading 1.5s infinite ease-in-out;
    background-color: var(--light-grey);
    border-radius: 8px;
    height: 38px;
    margin-bottom: 8px;
}

footer {
    text-align: center;
    padding: 25px;
    font-size: 0.9em;
    color: var(--footer-grey);
    border-top: 1px solid var(--border-color);
    margin-top: 40px;
}

/* =============================================================== */
/* TAILWIND CUSTOMIZATIONS & DARK MODE OVERRIDES                  */
/* =============================================================== */

/* Override default Tailwind styles to match the theme */
.side-panel {
    background-color: var(--widget-background);
    box-shadow: 0 4px 16px rgba(0,0,0,.1); /* Use a consistent shadow */
    margin: 1rem; /* Keep margin */
    height: fit-content;
}

.content-area {
    flex-grow: 1;
    padding: 1rem;
}

.tab-btn {
    padding: .75rem 1.5rem;
    font-weight: 600;
    border-radius: .375rem .375rem 0 0;
    border-bottom: 2px solid transparent;
    cursor: pointer;
    transition: all .2s;
    background-color: var(--light-grey); /* Adjusted for theme */
    color: var(--text-color);
    margin-right: .25rem;
}

.tab-btn.active {
    background-color: var(--widget-background); /* Use widget background */
    border-bottom: 2px solid var(--primary-color);
    color: var(--primary-color);
    box-shadow: 0 -2px 6px rgba(0,0,0,.05); /* Keep shadow */
}

.tab-content {
    background-color: var(--widget-background);
    padding: 1.5rem;
    border-radius: 0 .75rem .75rem .75rem;
    box-shadow: 0 4px 16px rgba(0,0,0,.08); /* Use widget shadow */
}
.tab-content:not(.active) { display: none; }

.subject-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1.5rem;
    box-shadow: 0 1px 4px rgba(0,0,0,.08);
    border-radius: .5rem;
    overflow: hidden;
    margin-bottom: 1.5rem;
}
.subject-table thead th {
    padding: .75rem;
    text-align: left;
    background-color: var(--primary-color);
    color: white;
    font-weight: 700;
}
.subject-table thead tr:first-child th {
    font-size: 1.125rem;
    text-align: center;
}
.subject-table tbody tr:nth-child(even) {
    background-color: var(--light-grey); /* Adjusted for theme */
}
.subject-table td {
    padding: .5rem .75rem;
    border-bottom: 1px solid var(--border-color);
}
.grade-percentage {
    font-weight: 700;
    color: var(--primary-color);
}

.subject-analysis {
    background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); /* Lighter primary */
    border: 1px solid color-mix(in srgb, var(--primary-color) 20%, transparent); /* Lighter primary border */
    padding: 1rem;
    border-radius: .5rem;
    margin-top: -1rem;
    margin-bottom: 1.5rem;
}

.analysis-badge {
    display: inline-flex;
    align-items: center;
    padding: .25rem .75rem;
    border-radius: 9999px;
    font-size: .875rem;
    font-weight: 600;
    margin-right: .5rem;
}
.badge-green { background-color: var(--goal-success-bg); color: var(--success-color); }
.badge-yellow { background-color: var(--goal-warning-bg); color: var(--warning-color); }
.badge-red { background-color: var(--goal-danger-bg); color: var(--danger-color); }
.badge-violet { background-color: color-mix(in srgb, var(--primary-color) 15%, transparent); color: var(--primary-color); } /* Adjusted */
.badge-blue { background-color: color-mix(in srgb, var(--accent-color) 15%, transparent); color: var(--accent-color); } /* Adjusted */
.badge-orange { background-color: color-mix(in srgb, var(--warning-color) 15%, transparent); color: var(--warning-color); } /* Adjusted */

.prediction-card {
    background-color: var(--widget-background); /* Use widget background */
    padding: 1rem;
    border-radius: .5rem;
    border-left: 5px solid;
    margin-bottom: 1rem;
    transition: all .2s;
    box-shadow: 0 1px 3px rgba(0,0,0,.05);
}
.card-green { border-left-color: var(--secondary-color); }
.card-violet { border-left-color: var(--primary-color); }
.card-yellow { border-left-color: var(--warning-color); }
.card-red { border-left-color: var(--danger-color); }
.card-score { font-size: 1.875rem; font-weight: 800; margin-top: .25rem; }

.probability-table th, .probability-table td {
    padding: .5rem;
    text-align: center;
    border: 1px solid var(--border-color);
}
.prob-high { background-color: var(--goal-success-bg); color: var(--success-color); font-weight: 700; }
.prob-medium { background-color: var(--goal-warning-bg); color: var(--warning-color); }
.prob-low { background-color: var(--goal-danger-bg); color: var(--danger-color); }

/* Modal Styles */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    transition: opacity .3s ease-out;
    opacity: 0;
    pointer-events: none;
}
.modal.active {
    opacity: 1;
    pointer-events: auto;
}
.modal-content {
    background: var(--widget-background); /* Use widget background */
    padding: 2rem;
    border-radius: .75rem;
    box-shadow: 0 10px 15px rgba(0,0,0,.1);
    max-width: 90%;
    width: 500px;
}
.modal-close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 2em;
    cursor: pointer;
    color: #aaa;
    line-height: 1;
    z-index: 1001;
}

.score-card {
    display: flex;
    align-items: center;
    padding: .75rem;
    border-radius: .5rem;
    background-color: var(--light-grey); /* Adjusted */
    transition: all .15s;
}
.score-card strong { font-size: 1.5rem; }
.score-icon { font-size: 1.5rem; margin-right: 1rem; }
.effort-needed { font-size: 1.25rem; font-weight: 700; }

.slider-label {
    font-weight: 600;
    margin-top: 1rem;
}

.ai-insight-box {
    background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); /* Lighter primary */
    border: 1px solid color-mix(in srgb, var(--primary-color) 20%, transparent); /* Lighter primary border */
    border-radius: .5rem;
    padding: 1rem;
    margin-top: .75rem;
}
.ai-insight-box h4 {
    display: flex;
    align-items: center;
    font-size: 1rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: .75rem;
}
.ai-insight-box h4 span {
    font-size: 1.25rem;
    margin-right: .5rem;
}
.ai-insight-box ul {
    list-style-type: none;
    padding-left: 0;
    font-size: .875rem;
}
.ai-insight-box li {
    position: relative;
    padding-left: 1.5rem;
    margin-bottom: .5rem;
    color: var(--text-secondary-color); /* Adjusted */
    line-height: 1.4;
}
.ai-insight-box li::before {
    content: '‚ö†Ô∏è'; /* Default icon */
    font-size: .75rem;
    position: absolute;
    left: 0;
    top: 4px;
}
.ai-insight-box li.insight-good::before { content: '‚úÖ'; }
.ai-insight-box li.insight-info::before { content: '‚ÑπÔ∏è'; }
.ai-insight-box li.insight-trend::before { content: 'üìà'; }
.ai-insight-box li.insight-focus::before { content: 'üéØ'; }
.ai-insight-box li.insight-priority::before { content: 'üß†'; }
.ai-insight-box li.insight-erratic::before { content: '‚ö°'; }

/* Gauge */
.gauge-container {
    width: 100%;
    padding: .5rem 0;
    margin-top: .5rem;
    margin-bottom: 1rem;
}
.gauge-bar {
    width: 100%;
    height: 12px;
    background: linear-gradient(90deg, var(--danger-color), var(--warning-color), var(--secondary-color));
    border-radius: 6px;
    position: relative;
    box-shadow: inset 0 1px 3px rgba(0,0,0,.1);
}
.gauge-needle {
    position: absolute;
    top: -4px; /* Center vertically on the bar */
    width: 4px;
    height: 20px; /* Make it slightly taller than the bar */
    background-color: var(--text-color); /* Use dark text color */
    border-radius: 2px;
    border: 1px solid var(--widget-background); /* Contrast border */
    box-shadow: 0 0 5px rgba(0,0,0,.5);
    transform: translateX(-50%); /* Center the needle on its 'left' position */
    transition: left .5s ease-out;
}
.gauge-labels {
    display: flex;
    justify-content: space-between;
    font-size: .75rem;
    font-weight: 600;
    color: var(--text-secondary-color); /* Adjusted */
    margin-top: .5rem;
}

/* Help Button */
.help-btn {
    position: fixed;
    top: 10px;
    right: 10px;
    width: 30px;
    height: 30px;
    background-color: var(--text-color); /* Use dark text color */
    color: var(--widget-background); /* Use light widget background */
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    text-decoration: none;
    box-shadow: 0 4px 10px rgba(0,0,0,.2);
    z-index: 999;
    cursor: pointer;
    transition: all .2s ease-in-out;
}
.help-btn:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 15px rgba(0,0,0,.3);
    background-color: var(--primary-color); /* Primary color on hover */
}

/* Help Modal */
#help-modal .modal-content {
    width: 750px;
    max-width: 95%;
    max-height: 90vh;
    overflow-y: auto;
    text-align: left;
}
.help-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 1rem;
    text-align: left;
}
.help-section-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--primary-color);
    margin-top: 1.5rem;
    border-bottom: 2px solid var(--primary-color);
    padding-bottom: 4px;
    margin-bottom: 1rem;
}
#help-modal h4 {
    font-size: 1.0rem;
    font-weight: 700;
    color: var(--text-color); /* Adjusted */
    margin-top: 1.25rem;
    margin-bottom: .25rem;
}
#help-modal p, #help-modal li {
    font-size: .95rem;
    color: var(--text-secondary-color); /* Adjusted */
    line-height: 1.6;
    margin-top: .5rem;
}
#help-modal ul {
    list-style-type: disc;
    padding-left: 2rem;
    margin-top: .5rem;
    margin-bottom: 1rem;
}
#help-modal ol.detailed-list {
    list-style-type: decimal;
    padding-left: 1.5rem;
}
#help-modal ol.detailed-list > li {
    font-weight: 600;
    color: var(--text-color); /* Adjusted */
    margin-top: 1rem;
}
#help-modal ol.detailed-list > li > ul {
    margin-top: .25rem;
    font-weight: normal;
}
#help-modal b {
    font-weight: 600;
    color: var(--text-color); /* Adjusted */
}

/* Back to Main Button */
.back-to-main-btn {
    position: fixed;
    top: 10px;
    left: 30px; /* Moved to left */
    width: 30px; /* Increased size */
    height: 30px;
    background-color: var(--primary-color);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.0rem;
    text-decoration: none;
    box-shadow: 0 4px 10px rgba(0,0,0,.2);
    z-index: 999;
    transition: all .2s ease-in-out;
}
.back-to-main-btn:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 15px rgba(0,0,0,.3);
    background-color: color-mix(in srgb, var(--primary-color) 80%, black); /* Darken on hover */
}

/* Unified container for all main page elements */
.main-container {
    display: flex;
    min-height: 100vh;
}

/* Side Panel */
.side-panel {
    width: 100%;
    max-width: 380px;
    padding: 1.5rem;
    box-shadow: 0 4px 16px rgba(0,0,0,.1);
    border-radius: .75rem;
    margin: 1rem;
    height: fit-content;
    background-color: var(--widget-background); /* Use theme variable */
}
.side-panel h2, .side-panel h3 {
    color: var(--text-color); /* Use theme variable */
}
.side-panel h2 {
    font-size: 1.5rem; /* Slightly larger */
    font-weight: 700;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--primary-color); /* Themed border */
}
.side-panel h3 {
    font-size: 1.125rem; /* Smaller heading */
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    color: var(--text-color);
}

/* Subject Averages List */
#subject-averages-list li {
    color: var(--text-secondary-color); /* Adjusted */
    font-size: 0.9rem;
}

/* Content Area */
.content-area {
    flex-grow: 1;
    padding: 1rem;
}
.content-area h1 {
    font-size: 2rem; /* Adjusted font size */
    font-weight: 700;
    margin-bottom: 1.5rem;
    color: var(--text-color);
}

/* Tab Navigation */
.flex.border-b {
    border-bottom: 2px solid var(--border-color); /* Themed border */
    margin-bottom: 1.5rem; /* Adjusted margin */
}

/* Prediction Cards - Global and Subject */
#global-predictions, #subject-predictions-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* Responsive grid */
    gap: 1rem;
}
.prediction-card .card-score {
    color: var(--primary-color); /* Ensure score color is consistent */
}

/* Mismatch Analysis Cards */
#mismatch-analysis > div {
    background-color: var(--widget-background); /* Use widget background */
    border-radius: .75rem; /* Consistent rounding */
    padding: 1.5rem;
    box-shadow: 0 1px 3px rgba(0,0,0,.05);
    border-left-width: 5px;
    border-left-style: solid;
}

/* Probability Table */
.probability-table {
    border-collapse: collapse;
    border-radius: .5rem;
    overflow: hidden;
    margin-top: 1rem;
    margin-bottom: 1.5rem;
}
.probability-table th {
    background-color: var(--primary-color);
    color: white;
    font-weight: 700;
    padding: 0.85rem 0.75rem; /* Slightly more padding */
    text-align: center;
}
.probability-table td {
    padding: 0.75rem;
    text-align: center;
    border-bottom: 1px solid var(--border-color);
}
.probability-table tbody tr:nth-child(even) {
    background-color: var(--light-grey); /* Adjusted */
}

/* Styles for dark mode */
[data-theme="dark"] {
    --bg-color: #121212; /* Very dark background */
    --widget-background: #1e1e1e; /* Darker widget background */
    --text-color: #e0e0e0; /* Light text */
    --text-secondary-color: #a0a0a0; /* Lighter secondary text */
    --footer-grey: #a0a0a0;
    --shadow-header: 0 2px 5px rgba(255,255,255,0.1);
    --shadow-widget: 0 5px 10px rgba(0,0,0,0.3);
    --border-color: #333333; /* Darker borders */
    --light-grey: #333333; /* Darker light grey elements */
    --goal-success-bg: #1a3e2a; /* Darker success bg */
    --goal-warning-bg: #4d381c; /* Darker warning bg */
    --goal-danger-bg: #4f2323; /* Darker danger bg */
}

/* Apply dark mode specific overrides */
[data-theme="dark"] body,
[data-theme="dark"] .content-area h1,
[data-theme="dark"] .side-panel h2,
[data-theme="dark"] .side-panel h3,
[data-theme="dark"] .text-gray-800, /* Overrides specific tailwind classes */
[data-theme="dark"] .text-gray-700,
[data-theme="dark"] .text-gray-600,
[data-theme="dark"] .text-gray-500,
[data-theme="dark"] .modal-content h3,
[data-theme="dark"] .modal-content p,
[data-theme="dark"] .ai-insight-box li,
[data-theme="dark"] .text-sm, [data-theme="dark"] .text-base, [data-theme="dark"] .text-lg, [data-theme="dark"] .text-xl, [data-theme="dark"] .text-2xl, [data-theme="dark"] .text-3xl, [data-theme="dark"] .text-4xl,
[data-theme="dark"] p, [data-theme="dark"] span, [data-theme="dark"] strong, [data-theme="dark"] div, [data-theme="dark"] button, [data-theme="dark"] label, [data-theme="dark"] select, [data-theme="dark"] th, [data-theme="dark"] td {
    color: var(--text-color); /* Use dark theme text color */
}

[data-theme="dark"] .text-gray-500, [data-theme="dark"] .text-xs, [data-theme="dark"] .text-sm.font-medium.text-gray-500, [data-theme="dark"] .gauge-labels span, [data-theme="dark"] .text-sm.text-gray-600 {
    color: var(--text-secondary-color);
}

[data-theme="dark"] .gauge-needle {
    background-color: var(--text-color); /* Darker needle */
    border-color: var(--widget-background); /* Lighter border */
}

/* Specific color overrides for dark mode */
[data-theme="dark"] .text-primary-color,
[data-theme="dark"] .text-violet-700,
[data-theme="dark"] .ai-insight-box h4,
[data-theme="dark"] #gauge-label-p50,
[data-theme="dark"] .grade-percentage,
[data-theme="dark"] #help-modal .help-title,
[data-theme="dark"] #help-modal .help-section-title {
    color: var(--primary-color);
}
[data-theme="dark"] .text-red-600 { color: var(--danger-color); }
[data-theme="dark"] .text-orange-600 { color: var(--warning-color); }

/* Backgrounds for dark mode */
[data-theme="dark"] .side-panel,
[data-theme="dark"] .tab-content,
[data-theme="dark"] .modal-content,
[data-theme="dark"] .subject-table tbody tr,
[data-theme="dark"] .subject-table tbody tr:nth-child(even),
[data-theme="dark"] .score-card,
[data-theme="dark"] .prediction-card {
    background-color: var(--widget-background);
}
[data-theme="dark"] .tab-btn {
    background-color: var(--light-grey);
    color: var(--text-secondary-color);
}
[data-theme="dark"] .tab-btn.active {
    background-color: var(--widget-background);
    color: var(--primary-color);
}
[data-theme="dark"] .subject-table td,
[data-theme="dark"] .side-panel h2,
[data-theme="dark"] .side-panel h3,
[data-theme="dark"] .content-area h1,
[data-theme="dark"] .flex.border-b,
[data-theme="dark"] .probability-table th,
[data-theme="dark"] .probability-table td,
[data-theme="dark"] .ai-insight-box,
[data-theme="dark"] .subject-analysis,
[data-theme="dark"] .modal-content,
[data-theme="dark"] #unites-list,
[data-theme="dark"] .border-t, [data-theme="dark"] .border-b, [data-theme="dark"] .border-l-4 {
    border-color: var(--border-color);
}
[data-theme="dark"] .subject-analysis {
    background-color: color-mix(in srgb, var(--primary-color) 20%, transparent); /* Darker shade for dark mode */
    border: 1px solid color-mix(in srgb, var(--primary-color) 30%, transparent);
}
[data-theme="dark"] .ai-insight-box {
     background-color: color-mix(in srgb, var(--primary-color) 25%, transparent); /* Darker shade */
     border-color: color-mix(in srgb, var(--primary-color) 40%, transparent);
}
[data-theme="dark"] .bg-violet-100 {
    background-color: color-mix(in srgb, var(--primary-color) 20%, transparent); /* Darker shade */
    border-color: var(--primary-color);
}
[data-theme="dark"] select, [data-theme="dark"] input[type="range"],
[data-theme="dark"] input { /* Apply to general inputs too */
    background-color: var(--widget-background);
    color: var(--text-color);
    border-color: var(--border-color);
}
[data-theme="dark"] #help-modal .modal-content {
    background: var(--widget-background);
}
[data-theme="dark"] #help-modal h4, [data-theme="dark"] #help-modal b {
     color: var(--text-color);
}
[data-theme="dark"] #help-modal p, [data-theme="dark"] #help-modal li {
     color: var(--text-secondary-color);
}

/* Dark mode badges */
[data-theme="dark"] .badge-green { background-color: var(--goal-success-bg); color: #D1FAE5; }
[data-theme="dark"] .badge-yellow { background-color: var(--goal-warning-bg); color: #FEF3C7; }
[data-theme="dark"] .badge-red { background-color: var(--goal-danger-bg); color: #FEE2E2; }
[data-theme="dark"] .badge-violet { background-color: color-mix(in srgb, var(--primary-color) 30%, transparent); color: var(--primary-color); }
[data-theme="dark"] .badge-blue { background-color: color-mix(in srgb, var(--accent-color) 30%, transparent); color: var(--accent-color); }
[data-theme="dark"] .badge-orange { background-color: color-mix(in srgb, var(--warning-color) 30%, transparent); color: var(--warning-color); }

/* === FIXES START HERE FOR DARK MODE === */
/* These specifically target elements that might not be overridden correctly by the general theme variables */

/* 1. Fix for bright probability table rows */
[data-theme="dark"] .prob-high { background-color: var(--goal-success-bg) !important; color: #D1FAE5 !important; }
[data-theme="dark"] .prob-medium { background-color: var(--goal-warning-bg) !important; color: #FEF3C7 !important; }
[data-theme="dark"] .prob-low { background-color: var(--goal-danger-bg) !important; color: #FEE2E2 !important; }

/* 2. Fix for bright table headers (which use Tailwind 'bg-gray-100') */
[data-theme="dark"] .bg-gray-100 { background-color: var(--light-grey) !important; } /* Use theme's dark light grey */

/* 3. NEW: Fix backgrounds for Mismatch cards (but DON'T touch their borders) */
[data-theme="dark"] #mismatch-analysis > div {
    background-color: var(--widget-background) !important;
    /* Border colors (like .card-red) are handled by their respective classes */
}

/* 4. NEW: Fix backgrounds AND borders for the *other* Prediction cards */
[data-theme="dark"] #global-predictions > div,
[data-theme="dark"] #subject-predictions-list > div {
    background-color: var(--widget-background) !important;
    border-color: var(--border-color) !important; /* General border color */
    border-left-width: 5px !important; /* Ensure border width remains */
    border-left-style: solid !important;
}

/* 5. NEW: Apply specific colors ONLY to the *other* Prediction cards */
[data-theme="dark"] #global-predictions > div.card-green,
[data-theme="dark"] #subject-predictions-list > div.card-green {
    border-left-color: var(--secondary-color) !important;
}
[data-theme="dark"] #global-predictions > div.card-violet,
[data-theme="dark"] #subject-predictions-list > div.card-violet {
    border-left-color: var(--primary-color) !important;
}
[data-theme="dark"] #global-predictions > div.card-yellow,
[data-theme="dark"] #subject-predictions-list > div.card-yellow {
    border-left-color: var(--warning-color) !important;
}
[data-theme="dark"] #global-predictions > div.card-red,
[data-theme="dark"] #subject-predictions-list > div.card-red {
    border-left-color: var(--danger-color) !important;
}
/* === FIXES END HERE === */
}
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
      
</head>
<body>

<a id="open-help-btn" class="help-btn" title="Comment √ßa marche ?">
    <i class="fa-solid fa-question"></i>
</a>

<!-- Theme Toggle Button -->
<button id="theme-toggle" class="help-btn" title="Changer de th√®me" style="right: 50px;">
    <i class="fa-solid fa-moon"></i> <!-- Initial icon for dark mode -->
</button>

<!-- Help Modal -->
<div id="help-modal" class="modal">
    <div class="modal-content">
        <span id="close-help-modal" class="modal-close">&times;</span>
        <h2 class="help-title">Guide D√©taill√© de l'Analyseur</h2>
        
        <p>Cet outil analyse votre <b>tendance</b> (votre "√©lan") et votre <b>volatilit√©</b> (votre stabilit√©) pour pr√©dire vos performances. Voici ce que chaque terme signifie en d√©tail.</p>

        <h3 class="help-section-title">Section Sp√©ciale : La R√©gression Lin√©aire (Le C≈ìur de l'IA)</h3>
        
        <h4>Qu'est-ce que c'est ?</h4>
        <p>Le "Moteur de D√©couverte (IA)" utilise un outil statistique appel√© <b>R√©gression Lin√©aire</b>. Son but est de trouver la "ligne de tendance" (la ligne droite de meilleur ajustement) qui passe au milieu d'un nuage de points de donn√©es. </p>
        <p>L'IA n'analyse pas seulement vos notes, elle analyse la <b>relation</b> entre deux variables. L'application effectue 3 analyses de r√©gression distinctes :</p>
        
        <ol class="detailed-list">
            <li><b>Mod√®le 1 : TENDANCE (Note vs. Temps)</b>
                <ul>
                    <li><b>(Axe X) :</b> Le temps (Devoir 1, Devoir 2, Devoir 3...)</li>
                    <li><b>(Axe Y) :</b> La note obtenue (85%, 88%, 87%...)</li>
                    <li><b>Ce qu'elle cherche :</b> "Est-ce que vos notes <b>montent</b> ou <b>baissent</b> avec le temps ?" C'est votre √©lan, ou "pente". C'est ce qui alimente le "Facteur de Tendance Globale".</li>
                </ul>
            </li>
            <li><b>Mod√®le 2 : FOCUS (Note vs. Pond√©ration du Devoir)</b>
                <ul>
                    <li><b>(Axe X) :</b> L'importance du devoir (Ex: 5%, 10%, 40%...)</li>
                    <li><b>(Axe Y) :</b> La note obtenue (95%, 90%, 82%...)</li>
                    <li><b>Ce qu'elle cherche :</b> "Avez-vous tendance √† mieux r√©ussir les <b>petits devoirs</b> ou les <b>gros examens</b> ?" Une pente n√©gative ici est un signal d'alarme : cela signifie que plus un examen est important, plus votre note a tendance √† baisser.</li>
                </ul>
            </li>
            <li><b>Mod√®le 3 : PRIORIT√â (Note vs. Pond√©ration de la Comp√©tence)</b>
                <ul>
                    <li><b>(Axe X) :</b> L'importance de la comp√©tence (Ex: 30%, 40%, 60%...)</li>
                    <li><b>(Axe Y) :</b> La note obtenue dans cette comp√©tence (90%, 85%, 80%...)</li>
                    <li><b>Ce qu'elle cherche :</b> "√ätes-vous meilleur dans les comp√©tences mineures ou majeures ?"</li>
                </ul>
            </li>
        </ol>

        <h4>Ce qui INFLUENCE la R√©gression (Votre question)</h4>
        <p>La "ligne de tendance" est comme une balan√ßoire. Ce qui l'influence le plus, ce sont les <b>points aberrants (Outliers)</b> et la <b>dispersion</b> de vos notes.</p>
        <ul>
            <li><b>Les Points Aberrants (Outliers) :</b> C'est l'influence n¬∞1. Si vous avez une moyenne de 90% mais que vous tombez malade et obtenez <b>20%</b> √† un examen, ce seul point tirera la "ligne de tendance" <b>massivement</b> vers le bas. L'IA verra cela comme une forte tendance n√©gative. De m√™me, un 100% facile sur un devoir tirera la ligne vers le haut.</li>
            <li><b>La Fiabilit√© (Le R¬≤) :</b> C'est le "Niveau de Confiance" de l'IA. C'est la statistique la plus importante que l'IA regarde.
                <ul>
                    <li>Un <b>R¬≤ √©lev√© (ex: 0.8 ou 80%)</b> signifie que vos notes sont tr√®s proches de la ligne de tendance. Le sch√©ma est <b>fiable</b>. L'IA peut affirmer avec certitude "Vous √™tes en hausse".</li>
                    <li>Un <b>R¬≤ faible (ex: 0.1 ou 10%)</b> signifie que vos notes sont "erratiques" et totalement dispers√©es autour de la ligne. Le sch√©ma est <b>non fiable</b>. C'est √† ce moment que l'IA vous dit : <b>"Je n'ai trouv√© aucun sch√©ma fiable"</b>, car la tendance qu'elle a trouv√©e n'explique que 10% de vos r√©sultats.</li>
                </ul>
            </li>
            <li><b>Le Nombre de Points (N) :</b> Une tendance sur 3 devoirs ne veut rien dire. Une tendance sur 30 devoirs est un sch√©ma tr√®s fort. C'est pourquoi l'IA ignore les mati√®res avec moins de 5 notes.</li>
        </ul>

        <h3 class="help-section-title">Panneau Principal (Gauche)</h3>
        
        <h4>Pr√©diction Globale Stochastique (Tendance MC)</h4>
        <p>"MC" signifie <b>Monte Carlo</b>. L'outil simule <b>100 000 sc√©narios possibles</b> pour l'√âtape 3. Chaque simulation est un "jet de d√©" bas√© sur :</p>
        <ol>
            <li><b>Votre moyenne projet√©e</b> (bas√©e sur la <b>Pente</b> de votre R√©gression Lin√©aire "Tendance").</li>
            <li><b>Votre volatilit√©</b> (votre <b>√âcart-Type</b>, ou "StdDev"). Un √©tudiant stable (faible volatilit√©) aura des simulations group√©es (ex: 88-92%). Un √©tudiant erratique (haute volatilit√©) aura des simulations dispers√©es (ex: 70-100%).</li>
        </ol>
        <p>Le score affich√© est le <b>P50 (M√©dian)</b> : le point exact o√π 50 000 simulations ont fait pire et 50 000 ont fait mieux. C'est le r√©sultat le plus probable.</p>

        <h4>Jauge de Performance (P5 √† P95)</h4>
        <p>C'est la carte compl√®te des 100 000 simulations :</p>
        <ul>
            <li><b>P5 (Pessimiste) :</b> 95 000 simulations ont donn√© un meilleur score. C'est votre "pire" sc√©nario probable.</li>
            <li><b>P50 (M√©dian) :</b> Le centre, identique √† la pr√©diction "Tendance MC".</li>
            <li><b>P95 (Optimiste) :</b> Seulement 5 000 simulations ont fait mieux. C'est le sc√©nario "r√™v√©".</li>
        </ul>

        <h4>Indices de Risque Dynamique</h4>
        <ul>
            <li><b>Indice de Consistance :</b> C'est l'inverse de votre <b>Volatilit√© (√âcart-Type)</b>. Un score de 100 signifie un √âcart-Type de 0 (ex: 90%, 90%, 90%). Un score bas signifie que vos notes sont tr√®s dispers√©es (ex: 60%, 100%, 75%).</li>
            <li><b>Risque de Burnout :</b> Score (sur 100) bas√© sur 4 facteurs : <b>1.</b> Volatilit√© (l'instabilit√© est stressante), <b>2.</b> Tendance (une pente n√©gative est un signe de difficult√©), <b>3.</b> Charge de travail (Unit√©s), <b>4.</b> Absent√©isme.</li>
            <li><b>Facteur de Tendance Globale :</b> C'est la <b>Pente (Slope)</b> de votre R√©gression "Tendance" x 10. (Ex: Pente de +0.2 = +2.0% F.T.G. = Vous gagnez 0.2 points par devoir, ou 2 points tous les 10 devoirs).</li>
        </ul>

        <h3 class="help-section-title">Analyse D√©taill√©e (Droite)</h3>

        <h4>Analyse de D√©s√©quilibre (Mismatch)</h4>
        <p>Cette section identifie les mati√®res "risqu√©es". Le "Score Mismatch" est √©lev√© si une mati√®re a :</p>
        <ul>
            <li><b>1. Une haute Volatilit√© (√âcart-Type) :</b> Vos notes sont tr√®s dispers√©es.</li>
            <li><b>2. Une faible Consistance :</b> Vos notes sont impr√©visibles.</li>
        </ul>
        <p>Une mati√®re "Rouge" (Mismatch √©lev√©) est une bombe √† retardement. C'est l√† que vous devez vous concentrer pour <b>stabiliser</b> vos r√©sultats (ex: visez des 80-90 constants plut√¥t que des 70-100 altern√©s).</p>

        <h4>Analyse de Chemin (Probabilit√©s)</h4>
        <p>Cette section vous donne un plan d'action. Elle r√©pond √† deux questions : <b>1.</b> "De quelle moyenne ai-je besoin ?" et <b>2.</b> "Quelles sont mes chances de l'obtenir ?"</p>
        <ul>
            <li><b>Moyenne Requise E2/E3 :</b> C'est un calcul alg√©brique simple pour d√©terminer la note exacte que vous devez obtenir √† l'√©tape 2 (ou 3) pour atteindre un objectif global.</li>
            <li><b>Probabilit√© (%) :</b> C'est la partie la plus importante. L'outil utilise la <b>Distribution Normale (CDF)</b>. Il compare la "Moyenne Requise" √† votre "Jauge de Performance (P5-P95)".</li>
            <li><b>Exemple :</b> Si votre "Moyenne Requise" est de <b>80%</b>, mais que votre jauge P5-P95 est entre 85% et 95%, votre probabilit√© de l'atteindre sera tr√®s √©lev√©e (ex: 99%), car 80% est en dessous de votre "pire" sc√©nario. Si la "Moyenne Requise" est de <b>96%</b>, elle est au-dessus de votre P95, donc la probabilit√© sera tr√®s faible (ex: <5%).</li>
        </ul>
    </div>
</div>

<!-- Back to Improve Button -->
<a href="improve.html" class="back-to-main-btn" title="Retour √† la page d'am√©lioration">
    <i class="fa-solid fa-arrow-left"></i>
</a>

<div class="main-container">

    <div class="side-panel lg:sticky lg:top-4">
        <h2 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">Moteur Stochastique V10 (Fix)</h2>

        <!-- Global Prediction Card -->
        <div class="bg-violet-100 p-4 rounded-lg mb-4 border-l-4 border-violet-600">
            <p class="text-sm font-medium text-gray-700">Pr√©diction Globale Stochastique (Tendance MC)</p>
            <strong id="moyenne-prediction" class="text-4xl font-extrabold text-violet-700">--</strong>
        </div>

        <!-- Performance Gauge -->
        <h3 class="text-lg font-semibold text-gray-800">Jauge de Performance (P5 √† P95)</h3>
        <div class="gauge-container">
            <div class="gauge-bar">
                <div id="gauge-needle" class="gauge-needle" style="left: 50%;"></div>
            </div>
            <div class="gauge-labels">
                <span id="gauge-label-p5">P5: --%</span>
                <strong id="gauge-label-p50" class="text-primary-color">P50: --%</strong>
                <span id="gauge-label-p95">P95: --%</span>
            </div>
        </div>
        
        <!-- Dynamic Risk Indices -->
        <h3 class="text-lg font-semibold mt-6 mb-3 text-gray-800 border-b pb-2">Indices de Risque Dynamique</h3>
        <div id="deep-analysis-scorecard" class="space-y-3 mb-6">
            <div class="score-card score-high" id="consistency-score">
                <span class="score-icon text-gray-600">üéØ</span>
                <div>
                    <p class="text-sm font-medium text-gray-500">Indice de Consistance/Volatilit√© (100 = Parfait)</p>
                    <strong class="text-xl text-gray-800">--</strong>
                </div>
            </div>
            <div class="score-card score-low" id="burnout-risk-score">
                <span class="score-icon text-red-600">üî•</span>
                <div>
                    <p class="text-sm font-medium text-gray-500">Score de Risque de Burnout (100 = Risque Maximal pour Perte de Contr√¥le)</p>
                    <strong class="text-xl text-red-600">--</strong>
                </div>
            </div>

            <!-- AI Insight Box -->
            <div class="ai-insight-box" id="ai-insight-container">
                <h4><span>üîé</span> Moteur de D√©couverte (IA)</h4>
                <p class="text-xs text-gray-500 -mt-2 mb-3">L'IA a scann√© vos donn√©es et a trouv√© les corr√©lations les plus fortes (R¬≤ > 0.25) :</p>
                <ul id="ai-insights-list">
                    </ul>
            </div>
            
            <!-- Trend Factor -->
            <div class="score-card score-low" id="dff-score">
                <span class="score-icon text-orange-600">üìâ</span>
                <div>
                    <p class="text-sm font-medium text-gray-500">Facteur de Tendance Globale (Pente / 10 devoirs)</p>
                    <strong class="text-xl text-orange-600">--</strong>
                </div>
            </div>
        </div>

        <!-- Current Settings -->
        <h3 class="text-lg font-semibold mt-4 mb-2 text-gray-700 border-t pt-3">Param√®tres Actuels</h3>
        <div class="space-y-3 mb-6 text-sm">
            <div>
                <label for="niveau-secondaire" class="block text-sm font-medium text-gray-700">Niveau Secondaire</label>
                <select id="niveau-secondaire" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm py-2 px-3 focus:ring-primary-500 focus:border-primary-500">
                    <option value="">S√©lectionner</option>
                    <option value="sec4">Secondaire 4</option>
                    <option value="sec5">Secondaire 5</option>
                </select>
            </div>
            <div>
                <label class="slider-label block text-sm font-medium text-gray-700">Taux d'Absent√©isme/D√©sengagement</label>
                <input type="range" id="absence-rate-slider" min="0" max="25" step="0.5" value="5" class="w-full mt-1">
                <p class="text-xs text-gray-500 mt-1">Impact sur B-Risk : <span id="absence-rate-value">5.0%</span></p>
            </div>

            <div>
                <label for="unites-mode" class="block text-sm font-medium text-gray-700">Mode Unit√©s (Pond√©ration)</label>
                <div class="flex space-x-2">
                    <select id="unites-mode" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm py-2 px-3 focus:ring-primary-500 focus:border-primary-500">
                        <option value="defaut">D√©faut (Officiel)</option>
                        <option value="sans">Sans Unit√©s (Moy. Simple)</option>
                        <option value="perso">Personnalis√©</option>
                    </select>
                    <button id="unites-btn" class="bg-gray-200 text-gray-600 rounded-md px-3 hover:bg-gray-300 transition duration-150 text-sm">√âditer</button>
                </div>
            </div>
        </div>

        <!-- Subject Averages List -->
        <h3 class="text-lg font-semibold mt-4 mb-2 text-gray-700 border-t pt-3">Moyennes par Mati√®re (<span id="active-etape-name">1</span>)</h3>
        <ul id="subject-averages-list" class="space-y-2 text-base">
            </ul>

    </div>

    <!-- Main Content Area -->
    <div class="content-area">
        <h1 class="text-3xl font-bold mb-4 text-gray-800">D√©tails de Performance & Pr√©dictions</h1>

        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-200 mb-4">
            <button class="tab-btn active" data-tab="etape1">√âtape 1 - Analyse</button>
            <button class="tab-btn" data-tab="etape2">√âtape 2 - Analyse</button>
            <button class="tab-btn" data-tab="etape3">√âtape 3 - Projection</button>
            <button class="tab-btn" data-tab="simulation">Monte Carlo & Probabilit√©s</button>
        </div>

        <!-- Tab Contents -->
        <div id="tab-contents">
            <div id="etape1" class="tab-content active">
                <!-- Content for Etape 1 will be loaded here by JS -->
                </div>
            <div id="etape2" class="tab-content">
                <!-- Content for Etape 2 will be loaded here by JS -->
                </div>
            <div id="etape3" class="tab-content">
                <!-- Content for Etape 3 will be loaded here by JS -->
                </div>

            <div id="simulation" class="tab-content">
                <h2 class="text-2xl font-bold mb-4 text-primary-color">Analyse Pr√©dictive Stochastique (100,000 Sc√©narios)</h2>
                <p class="text-gray-600 mb-6 border-b pb-4">
                    *Le mod√®le utilise la **R√©gression Lin√©aire** pour la tendance de base et projette la performance. Les probabilit√©s sont calcul√©es √† l'aide d'une **CDF Normale** bas√©e sur la tendance et la volatilit√© (StdDev) de vos notes. Ces donn√©es sont des estimations statistiques.*
                </p>

                <h3 class="text-xl font-semibold mb-3 mt-4 text-gray-700">Pr√©dictions de Moyenne Finale Globale (Intervalles de Confiance)</h3>
                <div id="global-predictions" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4">
                    <!-- Global predictions will be loaded here -->
                    </div>

                <h3 class="text-xl font-semibold mb-3 mt-8 text-gray-700 border-t pt-4">Analyse de D√©s√©quilibre Volatilit√© / Effort (Mismatch)</h3>
                <div id="mismatch-analysis" class="space-y-4">
                    <!-- Mismatch analysis will be loaded here -->
                    </div>

                <h3 class="text-xl font-semibold mb-3 mt-8 text-gray-700 border-t pt-4">Analyse de Chemin : Moyenne Requise √† l'√âtape 2</h3>
                <p class="text-sm text-gray-600 mb-4">Moyenne exacte que vous devez obtenir √† l'**√âtape 2** (bas√© sur E1 et la projection E3) pour atteindre chaque objectif global.</p>
                <table class="probability-table w-full rounded-lg overflow-hidden">
                    <thead>
                        <tr class="bg-gray-100">
                            <th>Objectif Global (%)</th>
                            <th>Moyenne Requise E2 (%)</th>
                            <th>Probabilit√© (%)</th>
                            <th>Analyse du Risque</th>
                        </tr>
                    </thead>
                    <tbody id="probability-table-body-e2">
                        <!-- Probability table body for Etape 2 will be loaded here -->
                        </tbody>
                </table>

                <h3 class="text-xl font-semibold mb-3 mt-8 text-gray-700 border-t pt-4">Analyse de Chemin : Moyenne Requise √† l'√âtape 3</h3>
                <p class="text-sm text-gray-600 mb-4">Moyenne exacte que vous devez obtenir √† l'**√âtape 3** (bas√© sur E1+E2) pour atteindre chaque objectif global.</p>
                <table class="probability-table w-full rounded-lg overflow-hidden">
                    <thead>
                        <tr class="bg-gray-100">
                            <th>Objectif Global (%)</th>
                            <th>Moyenne Requise E3 (%)</th>
                            <th>Probabilit√© (%)</th>
                            <th>Analyse du Risque</th>
                        </tr>
                    </thead>
                    <tbody id="probability-table-body-e3">
                        <!-- Probability table body for Etape 3 will be loaded here -->
                        </tbody>
                </table>

                 <h3 class="text-xl font-semibold mb-3 mt-8 text-gray-700 border-t pt-4">Pr√©dictions Tendancielles D√©taill√©es par Mati√®re</h3>
                <p class="text-sm text-gray-600 mb-4">Pr√©diction de note finale (E1+E2+E3) bas√©e sur la **Tendance par R√©gression Lin√©aire**. **Plafond√© au Max. Historique + 5%**.</p>
                <div id="subject-predictions-list" class="space-y-3">
                    <!-- Subject predictions will be loaded here -->
                    </div>
            </div>
        </div>
    </div>
</div>

<!-- Units Modal -->
<div id="unites-modal" class="modal">
    <div class="modal-content">
        <h3 class="text-xl font-bold mb-4">Unit√©s par Mati√®re</h3>
        <p class="text-sm text-gray-500 mb-4">Ajustez les unit√©s pour chaque mati√®re si le mode 'Personnalis√©' est s√©lectionn√©.</p>
        <div id="unites-list" class="max-h-80 overflow-y-auto border p-3 rounded-md space-y-2">
            <!-- Units list will be loaded here -->
            </div>
        <div class="mt-6 flex justify-end">
            <button id="close-unites-modal" class="bg-primary-color text-white px-4 py-2 rounded-md hover:bg-violet-700 transition">Fermer & Appliquer</button>
        </div>
    </div>
</div>

<!-- JavaScript Files -->
<script src="js/projected-averages.js"></script> 
<script src="js/projection.js"></script>

<!-- Inline script for instant theme loading -->
<script>
    const themeToggle = document.getElementById('theme-toggle');
    const html = document.documentElement;
    const toggleIcon = themeToggle.querySelector('i'); // Get the icon element inside the button
    const THEME_KEY = 'mbs-theme'; // Consistent key for localStorage

    const updateTheme = (theme) => {
        html.setAttribute('data-theme', theme);
        localStorage.setItem(THEME_KEY, theme);
        // Update icon based on theme
        if (theme === 'dark') {
            toggleIcon.className = 'fa-solid fa-sun'; // Show sun for dark mode
            toggleIcon.setAttribute('title', 'Passer en th√®me clair');
        } else {
            toggleIcon.className = 'fa-solid fa-moon'; // Show moon for light mode
            toggleIcon.setAttribute('title', 'Passer en th√®me sombre');
        }
    };

    // Apply theme on load
    const storedTheme = localStorage.getItem(THEME_KEY);
    // Check system preference if no theme is stored
    const initialTheme = storedTheme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    updateTheme(initialTheme);

    // Add event listener for theme toggle button
    themeToggle.addEventListener('click', () => {
        const currentTheme = html.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        updateTheme(newTheme);
    });
</script>

</body>
</html>
